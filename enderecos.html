<html>
    <head>
        <title>Livraria Nerdoteca</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
        <script src="src/jquery-3.7.1.slim.min.js" > </script>
        <style>
            .card-img-top{
                max-height: 410px;
            }
        </style>
    </head>

    <body>
        
        <!--CABECALHO-->
        <nav class="navbar bg-body-tertiary">
            <div class="container-fluid">
                <a class="navbar-brand" href="index.html"><b>Nerdoteca</b></a>               
                
               <h2>Meus endereços </h2>
                <form action="cadastro.html">
                </form>
            </div>
        </nav>

        <div class="container">
            <div class="row">
              <div class="col-9">
                <div class="card-body">
                  <h5 class="card-title"><b>Endereços de Entrega</b></h5><br>
                  
                  <div id="containerEnderecos">
                    
                  </div>
                    
                </div>
                <br>
                
                  <button type="button" class="btn btn-success" id="addEndereco" >Adicionar endereço</button>
                  <a href="finalizacao.html" class="btn btn-warning" >Enviar para este endereço</a>
              </div>
            </div>
            <div class="row" style="margin-top: 30px;" id="containerEndereco">
              <div class="col">
                <div class="card" style="width: 18rem;">
                 
                  <div class="card-body">
                    <h5 class="card-title"> Novo endereço</h5>
                    <div class="input-group mb-3 ">
                      <!-- <input type="text" class="form-control  mb-3" id="tipoEndereco" placeholder="Tipo de endereco"> -->
                      <select name="tipoResidencia" id="tipoResidencia" class="form-select mb-3">
                        <option disabled selected value>Tipo do Endereço</option>
                        <option value="residencial">Residencial</option>
                        <option value="Comercial">Comercial</option>
                        <option value="Outro">Outro</option>
                      </select>
                    </div>

                    <div class="input-group mb-3">
                      <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">Logradouro</button>
                      <ul class="dropdown-menu" id="tipoLogradouro">
                        <li><a class="dropdown-item" href="#" data-id="rua">Rua</a></li>
                        <li><a class="dropdown-item" href="#" data-id="avenida">Avenida</a></li>
                        <li><a class="dropdown-item" href="#" data-id="travessa">Travessa</a></li>                        
                        <li><a class="dropdown-item" href="#" data-id="alameda">Alameda</a></li>
                      </ul>
                      <input type="text" class="form-control" id="logradouro" aria-label="Logradouro">
                    </div>
                    
                    <div class="input-group mb-3 ">
                      <input type="text" class="form-control  mb-3" id="numero" placeholder="Número">
                    </div>
                    <div class="input-group mb-3 ">
                      <input type="text" class="form-control  mb-3" id="bairro" placeholder="Bairro">

                    </div>
                    <div class="input-group mb-3 ">
                        <input type="text" class="form-control  mb-3" id="cep" placeholder  ="CEP">
                    </div>
                    <div class="input-group mb-3">
                      <input type="text" class="form-control  mb-3" id="cidade" placeholder="Cidade">
                    </div>    
                    <div class="input-group mb-3">  
                      <select name="estado" id="estado" class="form-select mb-3">
                        <option value="">Estado</option> 
                        <option value="AC">AC</option> 
                        <option value="AL">AL</option> 
                        <option value="AP">AP</option> 
                        <option value="AM">AM</option> 
                        <option value="BA">BA</option> 
                        <option value="CE">CE</option> 
                        <option value="ES">ES</option> 
                        <option value="GO">GO</option> 
                        <option value="MA">MA</option> 
                        <option value="MT">MT</option> 
                        <option value="MS">MS</option> 
                        <option value="MG">MG</option> 
                        <option value="PA">PA</option> 
                        <option value="PB">PB</option> 
                        <option value="PR">PR</option> 
                        <option value="PE">PE</option> 
                        <option value="PI">PI</option> 
                        <option value="RJ">RJ</option> 
                        <option value="RN">RN</option> 
                        <option value="RS">RS</option> 
                        <option value="RO">RO</option> 
                        <option value="RR">RR</option> 
                        <option value="SC">SC</option> 
                        <option value="SP">SP</option> 
                        <option value="SE">SE</option> 
                        <option value="TO">TO</option> 
                        <option value="DF">DF</option> 
                      </select>
                    </div>
                    <div>
                      <input type="text" class="form-control  mb-3" id="pais" placeholder="País">
                    </div>  
                    <div>
                      <input type="text" class="form-control  mb-3" id="obs" placeholder="Observações">
                    </div>  
                    <button type="button" id="salvarEndereco" class="btn btn-primary">Salvar</a>
                  </div> 
                </div>
              </div>
            </div>
          </div>
     
               
        <!--RODAPE-->
        
        <footer class="d-flex flex-wrap justify-content-between align-items-center py-3 my-4 border-top">
            <div class="col-md-4 d-flex align-items-center">
            <a href="/" class="mb-3 me-2 mb-md-0 text-muted text-decoration-none lh-1">
                <svg class="bi" width="30" height="24"><use xlink:href="#bootstrap"></use></svg>
            </a>
            <span class="text-muted right">© 2024 Nerdoteca, Inc LTDA</span>
            </div>
        
            <ul class="nav col-md-4 justify-content-end list-unstyled d-flex">
            <li class="ms-3"><a class="text-muted" href="#"><svg class="bi" width="24" height="24"><use xlink:href="#twitter"></use></svg></a></li>
            <li class="ms-3"><a class="text-muted" href="#"><svg class="bi" width="24" height="24"><use xlink:href="#instagram"></use></svg></a></li>
            <li class="ms-3"><a class="text-muted" href="#"><svg class="bi" width="24" height="24"><use xlink:href="#facebook"></use></svg></a></li>
            </ul>
        </footer>
            
    </body>

    <template id="templateEndereco">
      <div>
        <input type="radio" name="tipoEndereco" id="enderecoSelecionado" value="{{tipoEndereco}}" class="enviarPara">
        <label>
          {{tipoLogradouro}}, {{logradouro}}, {{numero}}, {{bairro}}, {{cidade}} - {{estado}} - {{cep}}
        </label><br>
      </div>
    </template>
</html>

<script type="text/javascript">
    exibeEndereco();

    var tipoLogradouro;

    $('.dropdown-item').click(function() {
      tipoLogradouro = $(this).attr("data-id");
      
    });

    $("#addEndereco").on("click", function(){
        $("#containerEndereco").toggle();         
        
    })

    $("#salvarEndereco").on("click", salvarEndereco)

    async function salvarEndereco(){
        //Pegando os valores dos inputs e colocando em variáveis
        var tipoEndereco = $('#tipoEndereco').val();
        var tipoResidencia = $('#tipoResidencia').val();
        var logradouro = $('#logradouro').val();
        var numero = $('#numero').val();
        var bairro = $('#bairro').val();
        var cep = $('#cep').val();
        var cidade = $('#cidade').val();
        var estado = $('#estado').val();
        var pais = $('#pais').val();
        var obs = $('#obs').val();

        //colocando o valor das variáveis dentro do json dados
        var dados = {
            "nomeEndereco": "Endereco residencial",
            "tipoEndereco": tipoEndereco,
            "tipoResidencia": tipoResidencia,
            "cep": cep,
            "logradouro": logradouro,
            "tipoLogradouro": tipoLogradouro,
            "numero": numero,
            "bairro": bairro,
            "cidade": {
              "nome": cidade,
              "estado": {
                "nome": estado,
                "sigla": estado,
                "pais": pais
              }
            },
            "observacoes": obs
          }

        //enviando dados para a api
        resposta = await fetch('/api/novoEndereco', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(dados)
        });

        //limpando a variável dados
        dados = [];
        
        alert("Endereço salvo com sucesso");
    }

  
   

    async function exibeEndereco(){
      carregaTemplate();
    }

    async function carregaTemplate(){
      const resposta = await fetch('respostaEndereco.json');
      const dados = await resposta.json();
      
      console.log("carregando", dados)
      var template = $("#templateEndereco");

      for(item in dados){
        console.log(dados[item].logradouro);
        elemento = dados[item]

        $("#containerEnderecos").append(
            template.html()
              .replace(/{{tipoEndereco}}/g, elemento.tipoEndereco)
              .replace(/{{tipoLogradouro}}/g, elemento.tipoLogradouro)
              .replace(/{{logradouro}}/g, elemento.logradouro)
              .replace(/{{numero}}/g, elemento.numero)
              .replace(/{{bairro}}/g, elemento.bairro)
              .replace(/{{cidade}}/g, elemento.cidade.nome)
              .replace(/{{estado}}/g, elemento.cidade["estado"].nome)
              .replace(/{{cep}}/g, elemento.cep)        
          )
      }

      $(".enviarPara").on("click", function(){
          // necessario criar uma api para definir o endereco padrão, receberá apenas um parametro 'tipoEndereco'
          var enviarPara = document.querySelector('input[name="tipoEndereco"]:checked').value;
          fetch('/api/enderecoPadrao', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({"enviarPara": enviarPara})
          });
      });

    }


</script>


